name: Skaffold
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - uses: hiberbee/actions.skaffold@master
        with:
          args: version

      - uses: hiberbee/actions.skaffold@master
        env:
          SKAFFOLD_DEFAULT_REPO: docker.pkg.github.com/hiberbee/actions
          SKAFFOLD_SKIP_TESTS: true
        with:
          docker_registry: docker.pkg.github.com/hiberbee/actions
          docker_username: ${{ github.actor }}
          docker_password: ${{ secrets.docker_password }}

      - uses: hiberbee/actions.skaffold@master
        with:
          entrypoint: container-structure-test
          args: test --config=container-structure-test.yaml --image=docker.pkg.github.com/hiberbee/actions/skaffold
